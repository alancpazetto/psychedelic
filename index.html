<html>
<head>
	<title>Teste CSS 3D</title>
	<meta charset="utf-8"/>

	<link rel="stylesheet" type="text/css" href="layout.css">

</head>
<body>

<div class="div-principal">

	<div class="div-overlay">
		<h1>Just click!</h1>
	</div>

	<div class="divs-container"></div>

	<audio id="som1">
		<source src="som1.mp3"></source>
		Your browser isn't invited for super fun audio time.
	</audio>

	<audio id="som2">
		<source src="som2.mp3"></source>
		Your browser isn't invited for super fun audio time.
	</audio>

</div>

<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="http://cdn.jsdelivr.net/velocity/1.2.2/velocity.min.js"></script>

<script type="text/javascript">

$(document).ready(function(){

	$('#som1, #som2').hide();

	var som1 = $('#som1')[0];
	var som2 = $('#som2')[0];
	var interval1 = null;
	var interval2 = null;

	for (var i = 0; i < 100; i++) {
		
		var div = $('<div>');

		div.css({
			zIndex : (100-i),
			background : 'rgb(' + ( Math.round( Math.random() * 255 ) ) + ', ' + ( Math.round( Math.random() * 255 ) ) + ', ' + ( Math.round( Math.random() * 255 ) ) + ')',
		});

		div.addClass('div-3d');

		$('.divs-container').append(div);

	};

	var running = false;
	$(window).on('click', function(){

		$('.div-overlay').velocity({
			opacity: 0
		}, {
			duration : 100
		});

		if(!running){

			running = !running;

			interval1 = setInterval(function(){
				som1.play();
			},220);

			interval2 = setInterval(function(){
				som2.play();
			},5000);

			$('.divs-container').find('div').each(function(key){
				
				var ty = $(this).css('transform');
				
				$(this).velocity({
					rotateX : '+='+Math.random()*180,
					rotateY : '+='+Math.random()*180,
					rotateZ : '+='+Math.random()*180,
					translateX : '-='+Math.random()*200,
					translateY : '-='+Math.random()*200,
					translateZ : '-='+Math.random()*200,
					opacity: 0,
					backgroundColor : 'rgb(' + ( Math.round( Math.random() * 255 ) ) + ', ' + ( Math.round( Math.random() * 255 ) ) + ', ' + ( Math.round( Math.random() * 255 ) ) + ')'
				}, {
					delay : Math.round( Math.random() * 255 ),
					duration : Math.round( Math.random() * 255 ),
					loop : true,
					progress : function(){
						$(this).css({
							background : 'rgb(' + ( Math.round( Math.random() * 255 ) ) + ', ' + ( Math.round( Math.random() * 255 ) ) + ', ' + ( Math.round( Math.random() * 255 ) ) + ')'
						});

						$('body').css({
							background : 'rgb(' + ( Math.round( Math.random() * 255 ) ) + ', ' + ( Math.round( Math.random() * 255 ) ) + ', ' + ( Math.round( Math.random() * 255 ) ) + ')'
						});

					}
				});

			});

		}else{

			running = !running;
			
			som1.pause();
			som2.pause();
			clearInterval(interval1);
			clearInterval(interval2);

			$('.divs-container').find('div').each(function(key){

				$(this).velocity('stop');

				$(this).velocity({
					rotateX : 0,
					rotateY : 0,
					rotateZ : 0,
					translateX : 0,
					translateY : 0,
					translateZ : 0,
					opacity : 1,
					backgroundColor : 'rgb(' + ( Math.round( Math.random() * 255 ) ) + ', ' + ( Math.round( Math.random() * 255 ) ) + ', ' + ( Math.round( Math.random() * 255 ) ) + ')'
				}, {
					delay : 10 * key,
					duration : 200
				});

			});

		}

	})

});

</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63358117-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>